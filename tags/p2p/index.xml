<?xml version="1.0" encoding="utf-8" standalone="yes"?>
<rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom">
    <channel>
        <title>P2p on 谁才是超级小马</title>
        <link>https://zx1360.github.io/tags/p2p/</link>
        <description>Recent content in P2p on 谁才是超级小马</description>
        <generator>Hugo -- gohugo.io</generator>
        <language>zh-CN</language>
        <copyright>zx1360</copyright>
        <lastBuildDate>Sun, 02 Nov 2025 16:37:54 +0800</lastBuildDate><atom:link href="https://zx1360.github.io/tags/p2p/index.xml" rel="self" type="application/rss+xml" /><item>
        <title>P2p学习</title>
        <link>https://zx1360.github.io/p/p2p%E5%AD%A6%E4%B9%A0/</link>
        <pubDate>Sun, 02 Nov 2025 16:37:54 +0800</pubDate>
        
        <guid>https://zx1360.github.io/p/p2p%E5%AD%A6%E4%B9%A0/</guid>
        <description>&lt;h2 id=&#34;nat&#34;&gt;NAT
&lt;/h2&gt;&lt;p&gt;&lt;strong&gt;私网内设备访问外网时, 路由器对其源ip:port转为唯一公网ip:随机端口&lt;/strong&gt;&lt;/p&gt;
&lt;table&gt;
  &lt;thead&gt;
      &lt;tr&gt;
          &lt;th&gt;类型&lt;/th&gt;
          &lt;th&gt;核心特点&lt;/th&gt;
      &lt;/tr&gt;
  &lt;/thead&gt;
  &lt;tbody&gt;
      &lt;tr&gt;
          &lt;td&gt;&lt;strong&gt;全锥型（Full Cone）&lt;/strong&gt;&lt;/td&gt;
          &lt;td&gt;1. 内网设备主动访问外网后，会开放一个固定公网端口；2. 任何外网设备，只要知道这个公网端口，都能主动连接内网设备。&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;&lt;strong&gt;地址受限锥型（Address-Restricted Cone）&lt;/strong&gt;&lt;/td&gt;
          &lt;td&gt;1. 仅允许 “内网设备主动访问过的外网 IP” 发起反向连接；2. 不限制外网设备的端口，只验证 IP 是否匹配。&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;&lt;strong&gt;端口受限锥型（Port-Restricted Cone）&lt;/strong&gt;&lt;/td&gt;
          &lt;td&gt;1. 比地址受限更严格，仅允许 “内网设备主动访问过的外网 IP + 对应端口” 发起反向连接；2. IP 或端口有一个不匹配，连接就会被拒绝。&lt;/td&gt;
      &lt;/tr&gt;
      &lt;tr&gt;
          &lt;td&gt;&lt;strong&gt;对称型（Symmetric）&lt;/strong&gt;&lt;/td&gt;
          &lt;td&gt;1. 内网设备&lt;strong&gt;访问不同外网目标时，会分配不同的公网端口&lt;/strong&gt;；2. 外网设备无法主动发起任何反向连接，仅支持内网主动发起的单向通信。&lt;/td&gt;
      &lt;/tr&gt;
  &lt;/tbody&gt;
&lt;/table&gt;
&lt;blockquote&gt;
&lt;ol&gt;
&lt;li&gt;对称型对不同的目标地址访问都会分配不同的端口.&lt;/li&gt;
&lt;li&gt;除了全锥型都会过滤掉 &lt;strong&gt;非活跃会话==且==非主动发起&lt;/strong&gt; 的请求来源.&lt;/li&gt;
&lt;/ol&gt;
&lt;/blockquote&gt;
&lt;ul&gt;
&lt;li&gt;NAT的存在使得内网设备几乎只能主动访问外部网络, 对外部来说, 内网部分不仅不透明还有可能被NAT过度保护.&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&#34;内网穿透&#34;&gt;内网穿透
&lt;/h2&gt;&lt;p&gt;&lt;strong&gt;内网设备向公共服务器建立连接, 其他设备通过请求公共服务器来间接与内网通信&lt;/strong&gt;&lt;/p&gt;
&lt;h2 id=&#34;p2p&#34;&gt;p2p
&lt;/h2&gt;&lt;p&gt;&lt;strong&gt;利用机制&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;即使是对称型NAT, 请求一个地址之后的临时port, 被另外地址的请求访问, 会视为原先的目标地址的回应, 会&amp;quot;放行&amp;quot;,&lt;/li&gt;
&lt;/ul&gt;
&lt;ol&gt;
&lt;li&gt;双方向中间服务器请求, 留下各自的&lt;code&gt;ip:port&lt;/code&gt;, 中间服务器分别响应其另外一方的信息.&lt;/li&gt;
&lt;li&gt;双方收到消息之后立刻高频率发送对应的请求, 争取在其之前的port失效之前&lt;code&gt;&amp;quot;续&amp;quot;&lt;/code&gt;上有效性.&lt;/li&gt;
&lt;li&gt;至此双方都有了对方承认的数据通道, 之后以&lt;code&gt;1/2port失效期&lt;/code&gt;的间隔发送&lt;code&gt;空数据的心跳包&lt;/code&gt;, 保持通道有效性.&lt;/li&gt;
&lt;/ol&gt;
</description>
        </item>
        
    </channel>
</rss>
